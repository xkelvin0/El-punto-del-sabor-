window.carrito||(window.carrito=[]);let carrito=window.carrito;const promociones={"combo-chaufa-familiar":{tipo:"porcentaje",valor:15,descripcion:"-15%"},"martes-de-wantanes":{tipo:"2x1",descripcion:"2x1"},"combo-aeropuerto":{tipo:"combo",descuento:7,descripcion:"Combo"}};function guardarCarrito(){localStorage.setItem("carrito",JSON.stringify(carrito))}function cargarCarrito(){const t=localStorage.getItem("carrito");carrito=t?JSON.parse(t):[],actualizarContadorCarrito()}function actualizarContadorCarrito(){const t=document.getElementById("carritoContador");if(t){const e=carrito.reduce((t,e)=>t+e.cantidad,0);t.textContent=e,t.style.display=e>0?"inline-block":"none"}}function setupCarrito(){cargarCarrito();const t=document.getElementById("carritoIcono");t&&(t.removeEventListener("click",manejarClickCarrito),t.addEventListener("click",manejarClickCarrito)),document.addEventListener("click",t=>{if(t.target.classList.contains("agregar-carrito")||"Comprar"===t.target.textContent){const e=t.target.closest(".card");if(e){const t=e.querySelector("h4").textContent.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),r=e.querySelector("h4").textContent,a=e.querySelector(".precio-comprar span")?.textContent||e.querySelector("span")?.textContent,o=a?parseFloat(a.replace("S/ ","").replace(",","")):0,i=e.querySelector("img")?.src||"";agregarAlCarrito(t,r,o,i)}}else if(t.target.classList.contains("btn-promo")){const e=t.target.closest(".promo-card");if(e){const t=e.querySelector("h3").textContent,r=t.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),a=parseFloat(e.querySelector(".discounted-price").textContent.replace("S/ ","").replace(",","")),o=e.querySelector(".promo-image")?.src||"";agregarAlCarrito(r,t,a,o)}}}),window.addEventListener("storage",t=>{"carrito"===t.key&&(cargarCarrito(),actualizarCarrito())})}function manejarClickCarrito(t){t.stopPropagation(),mostrarCarrito()}function mostrarCarrito(){const t=document.getElementById("carritoFlotante"),e=document.getElementById("carritoIcono"),r=document.getElementById("carritoContenido"),a=(document.getElementById("carritoItems"),document.getElementById("totalPrecio"),document.getElementById("btnPagar"),document.getElementById("cerrarCarrito"));if(!t||!e||!r)return;r.classList.add("mostrar"),actualizarCarrito();const btnPagar = document.getElementById("btnPagar"); if(btnPagar){btnPagar.addEventListener("click",function(e){e.stopPropagation(),window.location.href="pagar.html"})}if(cerrarCarrito){cerrarCarrito.removeEventListener("click",ocultarCarrito),cerrarCarrito.addEventListener("click",ocultarCarrito)};const o=document.querySelector(".carrito-cabecera");o&&o.addEventListener("click",t=>{t.stopPropagation()}),document.removeEventListener("click",manejarClicFueraCarrito),document.addEventListener("click",manejarClicFueraCarrito)}function manejarClicFueraCarrito(t){t.target.closest(".carrito-flotante")||t.target.closest(".carrito-icono")||ocultarCarrito()}function manejarClickPagar(){window.location.href="carrito.html"}function ocultarCarrito(){const t=document.getElementById("carritoContenido");t&&(t.classList.remove("mostrar"),document.removeEventListener("click",manejarClicFueraCarrito))}function actualizarCarrito(){const t=document.getElementById("carritoItems"),e=document.getElementById("totalPrecio");if(!t||!e)return;if(t.innerHTML="",0===carrito.length)return t.innerHTML='<p class="carrito-vacio">Tu carrito está vacío</p>',void(e.textContent="S/ 0.00");carrito.forEach(e=>{const r=document.createElement("div");r.className="carrito-item";let a=e.precio,o=(e.cantidad,e.precio);if(e.esPromoDescuento)a=e.precio*e.cantidad,o=e.precio_original||2*e.precio;else{const t=promociones[e.id];if(t)if("porcentaje"===t.tipo)a=e.precio*(1-t.valor/100);else if("2x1"===t.tipo){const t=Math.floor(e.cantidad/2),r=e.cantidad%2;a=t*e.precio+r*e.precio}else"combo"===t.tipo&&t.descuento&&(a=e.precio-t.descuento)}r.innerHTML=`\n            <img src="${e.imagen}" alt="${e.nombre}" class="carrito-item-imagen">\n            <div class="carrito-item-info">\n                <h4>${e.nombre}${e.esPromoDescuento?'<span class="etiqueta-promo"></span>':""}</h4>\n                ${e.esPromoDescuento?`<p class="precio">S/ ${a.toFixed(2)} <span class="precio-unitario">(Jueves de Wantanes - S/ ${o.toFixed(2)} c/u)</span></p>`:`<p class="precio">S/ ${a.toFixed(2)}</p>`}\n                <div class="cantidad-controls">\n                    <button class="cantidad-btn" data-action="decrease" data-id="${e.id}"${e.esPromoDescuento&&e.cantidad<=1?"disabled":""}>-</button>\n                    <span class="cantidad">${e.cantidad}</span>\n                    <button class="cantidad-btn" data-action="increase" data-id="${e.id}">+</button>\n                </div>\n            </div>\n            <button class="remove-btn" data-id="${e.id}">×</button>\n        `,t.appendChild(r)});let r=0;carrito.forEach(t=>{let e=0;if(t.esPromoDescuento)e=t.precio*t.cantidad;else{const r=promociones[t.id];if(r)if("porcentaje"===r.tipo)e=t.precio*t.cantidad*(1-r.valor/100);else if("2x1"===r.tipo){e=(Math.floor(t.cantidad/2)+t.cantidad%2)*t.precio}else e="combo"===r.tipo&&r.descuento?(t.precio-r.descuento)*t.cantidad:t.precio*t.cantidad;else e=t.precio*t.cantidad}e=parseFloat(e.toFixed(2)),r+=e}),e.textContent=`S/ ${r.toFixed(2)}`,t.querySelectorAll(".cantidad-btn").forEach(t=>{t.addEventListener("click",t=>{t.stopPropagation();const e=t.target.getAttribute("data-action");cambiarCantidad(t.target.getAttribute("data-id"),e)})}),t.querySelectorAll(".remove-btn").forEach(t=>{t.addEventListener("click",t=>{t.stopPropagation();eliminarDelCarrito(t.target.getAttribute("data-id"))})}),t.querySelectorAll(".carrito-item, .carrito-item-imagen, .carrito-item-info, .cantidad-controls, .cantidad").forEach(t=>{t.addEventListener("click",t=>{t.stopPropagation()})})}function cambiarCantidad(t,e){const r=carrito.find(e=>e.id===t);if(r){if(r.esPromoDescuento){if("increase"===e)r.cantidad++;else if("decrease"===e){if(!(r.cantidad>1))return void eliminarDelCarrito(t);r.cantidad--}}else if("increase"===e)r.cantidad++;else if("decrease"===e){if(!(r.cantidad>1))return void eliminarDelCarrito(t);r.cantidad--}0,guardarCarrito(),actualizarContadorCarrito(),actualizarCarrito(),mostrarNotificacion("Cantidad actualizada")}}function eliminarDelCarrito(t){carrito=carrito.filter(e=>e.id!==t),guardarCarrito(),actualizarContadorCarrito(),actualizarCarrito(),mostrarNotificacion("Producto eliminado del carrito")}window.agregarAlCarrito=function(t,e,r,a,o=1){window.carrito||(window.carrito=[],carrito=window.carrito);const i=e.toLowerCase().includes("jueves de wantanes");if(i){const i=carrito.find(e=>e.id===t+"-promo");if(i)i.cantidad+=o;else{const i={id:t+"-promo",nombre:e+" (Jueves de Wantanes)",precio:r,precio_original:2*r,imagen:a,cantidad:o,esPromoDescuento:!0};carrito.push(i)}}else{const i=carrito.find(e=>e.id===t&&!e.esPromoDescuento);i?i.cantidad+=o:carrito.push({id:t,nombre:e,precio:r,imagen:a,cantidad:o})}guardarCarrito(),actualizarContadorCarrito(),mostrarNotificacion(i?`¡Jueves de Wantanes! ${e} por S/ ${r}`:`${e} agregado al carrito`)},document.addEventListener("DOMContentLoaded",setupCarrito);