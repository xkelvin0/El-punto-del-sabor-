let carrito=[];const promociones={"combo-chaufa-familiar":{tipo:"porcentaje",valor:15,descripcion:"-15%"},"martes-de-wantanes":{tipo:"2x1",descripcion:"2x1"},"combo-aeropuerto":{tipo:"combo",descuento:7,descripcion:"Combo"}};function agregarAlCarrito(id,nombre,precio,imagen,cantidad=1){const esPromo2x1=nombre.toLowerCase().includes("martes de wantanes");if(esPromo2x1){const productoExistente=carrito.find(item=>item.id===id);if(productoExistente){productoExistente.cantidad+=2}else{carrito.push({id:id,nombre:nombre+" (2x1)",precio:precio*2,precioUnitario:precio,imagen:imagen,cantidad:2,esPromo2x1:true})}}else{const productoExistente=carrito.find(item=>item.id===id&&!item.esPromo2x1);if(productoExistente){productoExistente.cantidad+=cantidad}else{carrito.push({id:id,nombre:nombre,precio:precio,imagen:imagen,cantidad:cantidad})}}guardarCarrito();actualizarContadorCarrito();mostrarNotificacion(esPromo2x1?`¡Promoción 2x1 aplicada! 2x ${nombre} por S/ ${precio*2}`:`${nombre} agregado al carrito`)}function guardarCarrito(){localStorage.setItem("carrito",JSON.stringify(carrito))}function cargarCarrito(){const carritoGuardado=localStorage.getItem("carrito");carrito=carritoGuardado?JSON.parse(carritoGuardado):[];actualizarContadorCarrito()}function actualizarContadorCarrito(){const contador=document.getElementById("carritoContador");if(contador){const totalItems=carrito.reduce((total,item)=>total+item.cantidad,0);contador.textContent=totalItems;contador.style.display=totalItems>0?"inline-block":"none"}}function setupCarrito(){cargarCarrito();const carritoIcono=document.getElementById("carritoIcono");if(carritoIcono){carritoIcono.removeEventListener("click",manejarClickCarrito);carritoIcono.addEventListener("click",manejarClickCarrito)}document.addEventListener("click",e=>{if(e.target.classList.contains("agregar-carrito")||e.target.textContent==="Comprar"){const card=e.target.closest(".card");if(card){const id=card.querySelector("h4").textContent.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");const nombre=card.querySelector("h4").textContent;const precioTexto=card.querySelector(".precio-comprar span")?.textContent||card.querySelector("span")?.textContent;const precio=precioTexto?parseFloat(precioTexto.replace("S/ ","").replace(",","")):0;const imagen=card.querySelector("img")?.src||"";agregarAlCarrito(id,nombre,precio,imagen)}}else if(e.target.classList.contains("btn-promo")){const promoCard=e.target.closest(".promo-card");if(promoCard){const nombre=promoCard.querySelector("h3").textContent;const id=nombre.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");const discountedPrice=parseFloat(promoCard.querySelector(".discounted-price").textContent.replace("S/ ","").replace(",",""));const imagen=promoCard.querySelector(".promo-image")?.src||"";agregarAlCarrito(id,nombre,discountedPrice,imagen)}}});window.addEventListener("storage",e=>{if(e.key==="carrito"){cargarCarrito();actualizarCarrito()}})}function manejarClickCarrito(e){e.stopPropagation();mostrarCarrito()}function mostrarCarrito(){const carritoFlotante=document.getElementById("carritoFlotante");const carritoIcono=document.getElementById("carritoIcono");const carritoContenido=document.getElementById("carritoContenido");const carritoItems=document.getElementById("carritoItems");const totalPrecio=document.getElementById("totalPrecio");const btnPagar=document.getElementById("btnPagar");const cerrarCarrito=document.getElementById("cerrarCarrito");if(!carritoFlotante||!carritoIcono||!carritoContenido)return;carritoContenido.classList.add("mostrar");actualizarCarrito();if(cerrarCarrito){cerrarCarrito.removeEventListener("click",ocultarCarrito);cerrarCarrito.addEventListener("click",ocultarCarrito)}const carritoCabecera=document.querySelector(".carrito-cabecera");if(carritoCabecera){carritoCabecera.addEventListener("click",e=>{e.stopPropagation()})}document.removeEventListener("click",manejarClicFueraCarrito);document.addEventListener("click",manejarClicFueraCarrito)}document.addEventListener("DOMContentLoaded",setupCarrito);function manejarClicFueraCarrito(e){if(!e.target.closest(".carrito-flotante")&&!e.target.closest(".carrito-icono")){ocultarCarrito()}}function manejarClickPagar(){window.location.href="carrito.html"}function ocultarCarrito(){const carritoContenido=document.getElementById("carritoContenido");if(carritoContenido){carritoContenido.classList.remove("mostrar");document.removeEventListener("click",manejarClicFueraCarrito)}}function actualizarCarrito(){const carritoItems=document.getElementById("carritoItems");const totalPrecio=document.getElementById("totalPrecio");if(!carritoItems||!totalPrecio)return;carritoItems.innerHTML="";if(carrito.length===0){carritoItems.innerHTML='<p class="carrito-vacio">Tu carrito está vacío</p>';totalPrecio.textContent="S/ 0.00";return}carrito.forEach(item=>{const itemElement=document.createElement("div");itemElement.className="carrito-item";let precioFinal=item.precio;let mostrarCantidad=item.cantidad;let mostrarPrecioUnitario=item.precio;if(item.esPromo2x1){mostrarPrecioUnitario=item.precioUnitario||item.precio/2;const pares=Math.ceil(item.cantidad/2);precioFinal=mostrarPrecioUnitario*pares;if(item.cantidad%2!==0){item.cantidad++;guardarCarrito()}}else{const promo=promociones[item.id];if(promo){if(promo.tipo==="porcentaje"){precioFinal=item.precio*(1-promo.valor/100)}else if(promo.tipo==="2x1"){const pares=Math.floor(item.cantidad/2);const individuales=item.cantidad%2;precioFinal=pares*item.precio+individuales*item.precio}else if(promo.tipo==="combo"&&promo.descuento){precioFinal=item.precio-promo.descuento}}}itemElement.innerHTML=`
            <img src="${item.imagen}" alt="${item.nombre}" class="carrito-item-imagen">
            <div class="carrito-item-info">
                <h4>${item.nombre} ${item.esPromo2x1?'<span class="etiqueta-promo"></span>':""}</h4>
                ${item.esPromo2x1?`<p class="precio">S/ ${precioFinal.toFixed(2)} <span class="precio-unitario">(2 x S/ ${mostrarPrecioUnitario.toFixed(2)})</span></p>`:`<p class="precio">S/ ${precioFinal.toFixed(2)}</p>`}
                <div class="cantidad-controls">
                    <button class="cantidad-btn" data-action="decrease" data-id="${item.id}" ${item.esPromo2x1&&item.cantidad<=2?"disabled":""}>-</button>
                    <span class="cantidad">${item.esPromo2x1?item.cantidad/2:item.cantidad} ${item.esPromo2x1?"par/es":""}</span>
                    <button class="cantidad-btn" data-action="increase" data-id="${item.id}">+</button>
                </div>
            </div>
            <button class="remove-btn" data-id="${item.id}">×</button>
        `;carritoItems.appendChild(itemElement)});let total=0;carrito.forEach(item=>{let precioFinal=item.precio;if(item.esPromo2x1){const precioUnitario=item.precioUnitario||item.precio/2;const pares=Math.ceil(item.cantidad/2);precioFinal=precioUnitario*pares}else{const promo=promociones[item.id];if(promo){if(promo.tipo==="porcentaje"){precioFinal=item.precio*(1-promo.valor/100)}else if(promo.tipo==="2x1"){const pares=Math.floor(item.cantidad/2);const individuales=item.cantidad%2;precioFinal=pares*item.precio+individuales*item.precio}else if(promo.tipo==="combo"&&promo.descuento){precioFinal=item.precio-promo.descuento}}}total+=precioFinal});totalPrecio.textContent=`S/ ${total.toFixed(2)}`;carritoItems.querySelectorAll(".cantidad-btn").forEach(btn=>{btn.addEventListener("click",e=>{e.stopPropagation();const action=e.target.getAttribute("data-action");const id=e.target.getAttribute("data-id");cambiarCantidad(id,action)})});carritoItems.querySelectorAll(".remove-btn").forEach(btn=>{btn.addEventListener("click",e=>{e.stopPropagation();const id=e.target.getAttribute("data-id");eliminarDelCarrito(id)})});carritoItems.querySelectorAll(".carrito-item, .carrito-item-imagen, .carrito-item-info, .cantidad-controls, .cantidad").forEach(element=>{element.addEventListener("click",e=>{e.stopPropagation()})})}function cambiarCantidad(id,action){const item=carrito.find(item=>item.id===id);if(!item)return;if(action==="increase"){item.cantidad++}else if(action==="decrease"&&item.cantidad>1){item.cantidad--}else if(action==="decrease"&&item.cantidad===1){eliminarDelCarrito(id);return}guardarCarrito();actualizarContadorCarrito();actualizarCarrito();mostrarNotificacion(`Cantidad actualizada`)}function eliminarDelCarrito(id){carrito=carrito.filter(item=>item.id!==id);guardarCarrito();actualizarContadorCarrito();actualizarCarrito();mostrarNotificacion("Producto eliminado del carrito")}